<html lang="en">
  <head>
    <title>RTLib Summary Figures</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="figures/bootstrap.min.css">
    <link rel="stylesheet" href="figures/styles.css">
  </head>
  <body>
    <h1>RTLib Summary Figures</h1>

    <h3>Alignment Summaries by Experiment</h3>

    <div class="alignment-header">
      <select class="alignment-select">
      </select>
    </div>

    <div id="alignment_carousel" class="carousel alignment-carousel" data-ride="carousel">
      <ol class="carousel-indicators">
      </ol>
      <div class="carousel-inner">
      </div>
      <a class="carousel-control-prev" href="#alignment_carousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#alignment_carousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>

    <h3>Residual Summary</h3>

    <div class="figure-row">
      <img class="figure-img" src="figures/residuals_violin.png">
    </div>

    <h3>PEP Update Summary</h3>

    <div class="figure-row">
      <div class="figure-col">
        <img class="figure-img" src="figures/pep_new_scatterplot.png">
      </div>
      <div class="figure-col">
        <img class="figure-img" src="figures/fold_change_ids.png">
      </div>
    </div>
    <div class="figure-row">
      <div class="figure-col">
        <img class="figure-img" src="figures/ms1_intensity_validation.png">
      </div>
    </div>

    <script type="text/javascript" src="figures/jquery-3.3.1.slim.min.js"></script>
    <script type="text/javascript" src="figures/bootstrap.min.js"></script>
    <script>
      var data = $data

      // jQuery calls need to be escaped with "$$"
      // since the template file is passed as a string through python,
      // and templating is done by replacing the dollar sign

      // set up carousel
      $$(".alignment-carousel").carousel({
        interval: false,
        wrap: true
      })

      var num_experiments = data.alignment.length
      var experiment_names = []
      for(var i = 0; i < num_experiments; i++) {
        experiment_names.push(data.alignment[i].replace(/^.*[\\\/]/, ''))
        $$(".alignment-select").append(`<option value="${i}">${experiment_names[i]}</option>`)
        $$(".alignment-carousel .carousel-inner").append(`<div class="carousel-item">
          <img class="d-block w-100" src="${data.alignment[i]}">
        </div>`)
        $$(".alignment-carousel .carousel-indicators").append(`<li data-target="#alignment_carousel" data-slide-to="${i}"></li>`)
      }
      $$(".alignment-carousel .carousel-item").first().addClass("active")
      $$(".alignment-carousel .carousel-indicators li").first().addClass("active")

      $$(".alignment-select").change(function() {
        //$(".alignment-carousel").carousel()
        $$(".alignment-carousel").carousel(parseInt($(this)[0].value))
      })
      /*$$(".alignment-carousel").on("slide.bs.carousel", function(e) {
        console.log(e)
        $$(".alignment-select").val(experiment_names[e.to])
      })*/

      
    </script>
  </body>
</html>